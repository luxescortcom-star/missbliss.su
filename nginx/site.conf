cat > nginx/site.conf << 'EOF'
# Дополнительные настройки для Render
# Основная конфигурация остаётся в nginx.conf

# Дополнительные security headers
add_header X-Frame-Options "SAMEORIGIN" always;
add_header X-Content-Type-Options "nosniff" always;
add_header X-XSS-Protection "1; mode=block" always;
add_header Referrer-Policy "strict-origin-when-cross-origin" always;

# Оптимизация кэширования статических файлов
location ~* \.(jpg|jpeg|png|gif|ico|webp|svg|avif)$ {
    expires 1y;
    add_header Cache-Control "public, immutable";
    try_files $uri =404;
}

location ~* \.(css|js)$ {
    expires 30d;
    add_header Cache-Control "public, immutable";
    try_files $uri =404;
}

location ~* \.(woff|woff2|ttf|eot|otf)$ {
    expires 1y;
    add_header Cache-Control "public, immutable";
    try_files $uri =404;
}

# Защита системных файлов
location ~ /\.(ht|git|svn) {
    deny all;
    access_log off;
    log_not_found off;
}

location ~ /(config|database|logs|temp|vendor|includes/conf)/ {
    deny all;
    access_log off;
    log_not_found off;
}

# Специальные обработки для вашего сайта
location /cache/ {
    try_files $uri =404;
}

location /geo_cache/ {
    try_files $uri =404;
}

location /uploads/ {
    try_files $uri =404;
}

# Sitemap
location = /sitemap.xml {
    try_files $uri /sitemap.xml;
}

# Robots.txt
location = /robots.txt {
    try_files $uri /robots.txt;
}

# Favicon
location = /favicon.ico {
    try_files $uri /favicon.ico;
}
EOF